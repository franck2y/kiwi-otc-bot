<!DOCTYPE html><html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ðŸ“Š OTC Bot - Price Action</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon"></script>
  <style>
    body { font-family: sans-serif; background: #111; color: #fff; padding: 10px; }
    select, button { font-size: 16px; margin: 5px; padding: 5px; }
    .container { margin-top: 20px; }
    canvas { background: #222; border-radius: 10px; margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #1b1b1b; }
    th, td { padding: 8px; border: 1px solid #333; text-align: center; }
    th { background: #333; }
    .buy { color: #0f0; }
    .sell { color: #f00; }
    .wait { color: #ccc; }
    #next-signal { margin-top: 10px; font-size: 18px; }
  </style>
</head>
<body>
  <h2>ðŸ“Š OTC Bot - Signaux par Price Action</h2><label for="pair">Paire :</label> <select id="pair"> <option value="EUR/USD">EUR/USD</option> <option value="GBP/USD">GBP/USD</option> <option value="USD/JPY">USD/JPY</option> </select>

<button onclick="startBot()">DÃ©marrer le bot</button>

  <div id="next-signal">Prochain signal dans 60s</div>
  <div class="container">
    <canvas id="chart" width="400" height="200"></canvas>
  </div>  <table>
    <thead>
      <tr>
        <th>Heure</th>
        <th>O</th><th>H</th><th>L</th><th>C</th>
        <th>Signal</th>
      </tr>
    </thead>
    <tbody id="signal-body"></tbody>
  </table>  <script>
    const apiKey = "05d7b73a43a14818905654f8fbbe42f2";
    const interval = "1min";
    let countdown = 60;

    setInterval(() => {
      countdown--;
      document.getElementById('next-signal').textContent = `Prochain signal dans ${countdown}s`;
      if (countdown <= 0) {
        countdown = 60;
        updateSignal();
      }
    }, 1000);

    async function fetchData(symbol) {
      const res = await fetch(`https://api.twelvedata.com/time_series?symbol=${symbol}&interval=${interval}&apikey=${apiKey}&outputsize=5`);
      const json = await res.json();
      return json.values ? json.values.reverse().map(v => ({
        time: v.datetime,
        open: +v.open,
        high: +v.high,
        low: +v.low,
        close: +v.close
      })) : null;
    }

    function generateSignal(candle) {
      const body = Math.abs(candle.close - candle.open);
      const total = candle.high - candle.low;
      if (body / total > 0.6) {
        return candle.close > candle.open ? 'BUY' : 'SELL';
      } else {
        return 'WAIT';
      }
    }

    async function updateSignal() {
      const pair = document.getElementById('pair').value;
      const data = await fetchData(pair);
      if (!data || data.length < 3) return;

      const last = data[data.length - 1];
      const signal = generateSignal(last);

      document.getElementById('signal-body').innerHTML = `
        <tr>
          <td>${last.time}</td>
          <td>${last.open.toFixed(5)}</td>
          <td>${last.high.toFixed(5)}</td>
          <td>${last.low.toFixed(5)}</td>
          <td>${last.close.toFixed(5)}</td>
          <td class="${signal.toLowerCase()}"><b>${signal}</b></td>
        </tr>
      `;

      renderChart(data, pair);
    }

    function renderChart(data, label) {
      const ctx = document.getElementById('chart').getContext('2d');
      if (window.priceChart) window.priceChart.destroy();
      window.priceChart = new Chart(ctx, {
        type: 'candlestick',
        data: {
          datasets: [{
            label: label,
            data: data.map(d => ({ x: d.time, o: d.open, h: d.high, l: d.low, c: d.close }))
          }]
        },
        options: {
          scales: {
            x: { type: 'timeseries', time: { unit: 'minute' } },
            y: { beginAtZero: false }
          },
          plugins: { legend: { display: false } }
        }
      });
    }

    function startBot() {
      updateSignal();
    }
  </script></body>
</html>
