<!DOCTYPE html><html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üìä OTC Bot avec Fractals</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon"></script>
  <style>
    body { font-family: sans-serif; background: #111; color: #fff; padding: 10px; }
    select, button, input { font-size: 16px; margin: 5px; padding: 5px; }
    .container { margin-top: 20px; }
    canvas { background: #222; border-radius: 10px; margin-bottom: 20px; }
    table { width: 100%; margin-top: 20px; border-collapse: collapse; background: #1b1b1b; }
    th, td { padding: 8px; border: 1px solid #333; text-align: center; }
    th { background: #333; }
    .buy { color: #0f0; }
    .sell { color: #f00; }
    .signal-table { max-width: 100%; overflow-x: auto; }
    #debug { background: #000; color: lime; font-size: 12px; padding: 10px; margin-top: 20px; white-space: pre-wrap; border-radius: 5px; }
    #trade-alert { background: #1e1e1e; border: 2px solid #fff500; padding: 15px; margin-top: 10px; font-size: 18px; border-radius: 8px; color: #fff; display: none; }
    #trade-countdown { font-size: 24px; color: #fff500; margin-top: 10px; display: none; }
  </style>
</head>
<body>
  <h2>üìä OTC Bot avec Fractals</h2><label for="interval">‚è± Timeframe :</label> <select id="interval"> <option value="1min">1 Minute</option> <option value="5min">5 Minutes</option> <option value="15min">15 Minutes</option> </select>

<label>Bougies gauche :</label> <input type="number" id="leftDepth" value="2" min="1" max="5" />

<label>Bougies droite :</label> <input type="number" id="rightDepth" value="2" min="1" max="5" />

<button onclick="startBot()">D√©marrer</button> <button onclick="downloadSignals()">üì• T√©l√©charger les signaux</button>

  <div id="trade-alert"></div>
  <div id="trade-countdown"></div>
  <div id="next-signal">Prochain signal dans 60s</div>  <div class="container" id="charts"></div>  <div class="signal-table">
    <table>
      <thead>
        <tr><th>Paire</th><th>Fractal</th><th>Signal</th><th>Heure</th></tr>
      </thead>
      <tbody id="signal-body"></tbody>
    </table>
  </div>  <div id="debug"></div>
  <audio id="notifSound" src="https://notificationsounds.com/storage/sounds/file-sounds-1155-pristine.mp3"></audio>  <script>
    const apiKey = "05d7b73a43a14818905654f8fbbe42f2";
    const pairs = ["EUR/USD", "GBP/USD", "USD/JPY", "AUD/USD", "USD/CHF", "NZD/USD"];
    const signalLogs = [];
    let countdown = 60;

    setInterval(() => {
      countdown--;
      document.getElementById('next-signal').textContent = `Prochain signal dans ${countdown}s`;
      if (countdown <= 0) {
        countdown = 60;
        updateSignals();
      }
    }, 1000);

    function detectFractal(data, left, right) {
      const result = new Array(data.length).fill('');
      for (let i = left; i < data.length - right; i++) {
        const isTop = [...Array(left).keys()].every(j => data[i].high > data[i-j-1].high) &&
                      [...Array(right).keys()].every(j => data[i].high > data[i+j+1].high);
        const isBottom = [...Array(left).keys()].every(j => data[i].low < data[i-j-1].low) &&
                         [...Array(right).keys()].every(j => data[i].low < data[i+j+1].low);
        if (isTop) result[i] = '‚¨ÜÔ∏è';
        else if (isBottom) result[i] = '‚¨áÔ∏è';
      }
      return result;
    }

    async function fetchData(symbol, interval) {
      const res = await fetch(`https://api.twelvedata.com/time_series?symbol=${symbol}&interval=${interval}&apikey=${apiKey}&outputsize=50`);
      const json = await res.json();
      return json.values ? json.values.reverse().map(v => ({
        time: v.datetime,
        open: +v.open, high: +v.high, low: +v.low, close: +v.close
      })) : null;
    }

    async function updateSignals() {
      const interval = document.getElementById('interval').value;
      const left = +document.getElementById('leftDepth').value;
      const right = +document.getElementById('rightDepth').value;
      const signalBody = document.getElementById('signal-body');
      signalBody.innerHTML = '';
      document.getElementById('charts').innerHTML = '';

      for (let pair of pairs) {
        const canvas = document.createElement('canvas');
        document.getElementById('charts').appendChild(canvas);
        const data = await fetchData(pair, interval);
        if (!data) continue;

        const fractals = detectFractal(data, left, right);
        const last = fractals.at(-1);
        const signal = last === '‚¨ÜÔ∏è' ? 'SELL' : last === '‚¨áÔ∏è' ? 'BUY' : 'WAIT';
        const now = new Date().toLocaleTimeString();
        signalLogs.push(`${now} | ${pair} | ${last} | ${signal}`);
        signalBody.innerHTML += `<tr><td>${pair}</td><td>${last}</td><td class='${signal.toLowerCase()}'><b>${signal}</b></td><td>${now}</td></tr>`;

        new Chart(canvas.getContext('2d'), {
          type: 'candlestick',
          data: {
            datasets: [{
              label: pair,
              data: data.map(d => ({ x: d.time, o: d.open, h: d.high, l: d.low, c: d.close }))
            }]
          },
          options: {
            plugins: { legend: { display: false } },
            scales: {
              x: { type: 'timeseries', time: { unit: 'minute' } },
              y: { beginAtZero: false }
            }
          }
        });
      }
    }

    function startBot() {
      updateSignals();
    }

    function downloadSignals() {
      const blob = new Blob([signalLogs.join('\n')], { type: 'text/plain' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'signals.log';
      link.click();
    }
  </script></body>
</html>
